<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV Mapper - Browser Global Usage</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .example-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .code-block {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 3px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        input[type="file"] {
            margin: 10px 0;
        }
        #output {
            background: #f9f9f9;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 3px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>CsvMapper - Browser Global Usage</h1>
    <p>This example shows how to use CsvMapper as a global object in the browser without modules.</p>

    <div class="example-section">
        <h2>1. Basic File Upload</h2>
        <input type="file" id="csvFile" accept=".csv" />
        <div id="output"></div>
    </div>

    <div class="example-section">
        <h2>2. Static Methods Usage</h2>
        <button onclick="testStaticMethods()">Test Static CSV Parsing</button>
        <div class="code-block" id="staticResult"></div>
    </div>

    <div class="example-section">
        <h2>3. Custom Parser Example</h2>
        <button onclick="testCustomParser()">Test Custom Parser</button>
        <div class="code-block" id="customResult"></div>
    </div>

    <!-- Include the UMD build - this exposes the global CsvMapper object -->
    <script src="../dist/csv-mapper.umd.min.js"></script>
    
    <script>
        // CsvMapper is now available as a global object!
        console.log('CsvMapper global object:', window.CsvMapper);
        
        // Initialize the file input mapper
        const fileInput = document.getElementById('csvFile');
        const output = document.getElementById('output');
        
        // Create a CsvMapper instance with columns configuration
        const mapper = new CsvMapper(fileInput, {
            columns: [
                { name: 'name', title: 'Full Name', required: true },
                { name: 'email', title: 'Email Address', required: true },
                { name: 'age', title: 'Age', type: 'number' },
                { name: 'city', title: 'City' }
            ],
            showUserControls: true,
            controlsContainer: output
        });
        
        // Listen to events
        mapper.addEventListener('ready', (event) => {
            console.log('CSV loaded and ready:', event.detail);
            output.innerHTML += `<p><strong>Headers detected:</strong> ${event.detail.headers.join(', ')}</p>`;
        });
        
        mapper.addEventListener('mapped', (event) => {
            console.log('Data mapped:', event.detail);
            output.innerHTML += `<p><strong>Mapped ${event.detail.rows.length} rows</strong></p>`;
            
            // Show first few rows
            const preview = event.detail.rows.slice(0, 3).map(row => 
                `${row.name} (${row.email}) - Age: ${row.age}, City: ${row.city}`
            ).join('<br>');
            output.innerHTML += `<div><strong>Preview:</strong><br>${preview}</div>`;
        });
        
        // Test static methods
        function testStaticMethods() {
            const csvText = `name,email,age,city
John Doe,john@example.com,30,New York
Jane Smith,jane@example.com,25,Los Angeles
Bob Johnson,bob@example.com,35,Chicago`;
            
            // Use static parseCSV method
            const parsed = CsvMapper.parseCSV(csvText);
            
            // Use static detectDialect method
            const dialect = CsvMapper.detectDialect(csvText);
            
            // Use static toCsvRow method
            const newRow = CsvMapper.toCsvRow(['Alice Brown', 'alice@example.com', 28, 'Boston']);
            
            const result = `
Static Methods Test:

Parsed Data:
Headers: ${parsed.headers.join(', ')}
Rows: ${parsed.data.length}
First row: ${JSON.stringify(parsed.data[0])}

Detected Dialect:
Delimiter: '${dialect.delimiter}'
Quote: '${dialect.quoteChar}'
Escape: '${dialect.escapeChar}'

Generated CSV Row:
${newRow}
            `;
            
            document.getElementById('staticResult').textContent = result;
        }
        
        // Test custom parser
        function testCustomParser() {
            // Simple custom parser implementation
            class SimpleCsvParser {
                parseCSV(text, options = {}) {
                    const lines = text.split('\\n').filter(line => line.trim());
                    const delimiter = options.delimiter || ',';
                    
                    const rows = lines.map(line => {
                        return line.split(delimiter).map(field => field.trim());
                    });
                    
                    return {
                        data: rows.slice(1),
                        headers: rows[0] || [],
                        meta: { delimiter: delimiter, linebreak: '\\n' }
                    };
                }
                
                detectDialect(text) {
                    return {
                        delimiter: text.includes(',') ? ',' : ';',
                        quoteChar: '"',
                        escapeChar: '"',
                        lineTerminator: '\\n'
                    };
                }
                
                toCsvRow(arr, sep = ',', quote = '"') {
                    return arr.map(field => {
                        const str = String(field || '');
                        if (str.includes(sep) || str.includes(quote)) {
                            return quote + str.replace(/"/g, '""') + quote;
                        }
                        return str;
                    }).join(sep);
                }
            }
            
            const csvText = 'name;email;age\\nTest User;test@example.com;25';
            
            // Test with custom parser
            const customParser = new SimpleCsvParser();
            const customParsed = customParser.parseCSV(csvText);
            
            // Test with default parser for comparison
            const defaultParsed = CsvMapper.parseCSV(csvText);
            
            const result = `
Custom Parser Test:

Custom Parser Result:
Headers: ${customParsed.headers.join(', ')}
Data: ${JSON.stringify(customParsed.data[0])}

Default Parser Result:
Headers: ${defaultParsed.headers.join(', ')}
Data: ${JSON.stringify(defaultParsed.data[0])}

Note: Custom parser detected semicolon delimiter,
default parser might handle it differently.
            `;
            
            document.getElementById('customResult').textContent = result;
        }
    </script>
</body>
</html>
